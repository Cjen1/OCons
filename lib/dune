(library
 (name lib)
 (public_name ocaml-paxos)
 (libraries oUnit core core.uuid lwt yojson uri capnp-rpc-lwt capnp-rpc-unix
   lwt_ppx ocaml-protoc)
 (preprocess
  (pps ppx_jane lwt_ppx))
 (modules
  (:standard \ tests)))

(executable
 (name tests)
 (libraries oUnit lib)
 (modules tests))

(rule
 (targets message_api.ml message_api.mli)
 (deps message_api.capnp)
 (action
  (bash "capnp compile -o ocaml message_api.capnp")))

(rule
 (targets message_pb.ml message_pb.mli message_types.ml message_types.mli)
 (deps protobuf/message.proto)
 (action (bash "ocaml-protoc -binary -ml_out . protobuf/message.proto"))
 )

(env
 (dev
  (flags
   (:standard -warn-error -A))))
